<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="img/pikachu.png" type="image/x-icon">
    <link rel="stylesheet" href="./assets/css/all.min.css">
    <link rel="stylesheet" href="./assets/css/bootstrap.css">
    <link rel="stylesheet" href="./assets/css/carrusel.css">
    <link rel="stylesheet" href="./assets/css/style.css">
    <script src="./assets/js/all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
        integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
        crossorigin="anonymous"></script>
    <script src="./assets/js/bootstrap.js"></script>
    <script src="./assets/js/script.js"></script>

    <title>Pokemon store</title>
</head>

<body class="container-fluid bg-warning text-warning" ;
    onload="slideCatPokemon(), loadAllPokemon(), traerCompra(), totalCompra()">
    <div class="container-fluid">
        <div class="d-flex align-contents-center justify-content-around" style="margin-top: 17px;">
            <div class="row col-4">
                <div id="mostrarCategoriasPokemon">
                </div>
            </div>
            <div class="col-3 flex-column my-2 me-5">
                <input type="text" class="form-control" style="border-radius: 13px;" name="txtBuscar" id="txtBuscar"
                    onkeyup="autoCompletePokemon()">
                <div class="col-8" id="listPokemon"></div>
            </div>
            <div class="col-2 d-flex justify-content-end">

                <button type="button" class="btn btn-primary position-relative btn-lg" ondrop="drop(event)"
                    ondragover="allowDrop(event)" id="btnCar" data-bs-toggle="offcanvas"
                    data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">
                    <i class="fa-solid fa-cart-shopping"></i>

                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                        id="cantidadItems">
                        0
                        <span class="visually-hidden">unread messages</span>
                    </span>
                </button>

                <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight"
                    aria-labelledby="offcanvasRightLabel" style="margin-top: 60px;">
                    <div class="offcanvas-header">
                        <h5 id="offcanvasRightLabel">Lista de compras</h5>
                        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"
                            aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body" id="listcarpokemon">

                    </div>
                    <div class="offcanvas-footer text-center">
                        <span id="totalPagar">Total: </span>
                        <hr>
                        <a href="" class="btn btn-sm btn-primary mb-1">Finalizar compra</a>
                    </div>
                </div>
            </div>
        </div>

        <section class="row justify-content-evenly align-content-around " style="height: 400px;">
            <div class="col-8 row bg-info"
                style="background-image: url(img/fondoGif.gif); background-size: cover; background-repeat: no-repeat; ">
                <div id="carouselExampleDark" class="carousel carousel-dark slide" data-bs-ride="carousel">
                    <div class="carousel-indicators">
                        <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="0" class="active"
                            aria-current="true" aria-label="Slide 1"></button>
                        <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="1"
                            aria-label="Slide 2"></button>
                        <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="2"
                            aria-label="Slide 3"></button>
                    </div>
                    <div class="carousel-inner">
                        <div class="carousel-item active" data-bs-interval="10000">
                            <img id="pokemonUno" src="https://assets.pokemon.com/assets/cms2/img/pokedex/detail/025.png"
                                class="" alt="..." style="width: 40%;">
                            <div class="carousel-caption d-none d-md-block">
                                <h5 class="text-warning">First slide label</h5>
                                <p class="text-warning">Some representative placeholder content for the first slide.</p>
                            </div>
                        </div>
                        <div class="carousel-item" data-bs-interval="2000">
                            <img id="pokemonDos" src="https://assets.pokemon.com/assets/cms2/img/pokedex/detail/028.png"
                                class="" alt="..." style="width: 40%;">
                            <div class="carousel-caption d-none d-md-block">
                                <h5 class="text-warning">Second slide label</h5>
                                <p class="text-warning">Some representative placeholder content for the second slide.
                                </p>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <img id="pokemonTres"
                                src="https://assets.pokemon.com/assets/cms2/img/pokedex/detail/027.png" class=""
                                alt="..." style="width: 40%;">
                            <div class="carousel-caption d-none d-md-block">
                                <h5 class="text-warning">Third slide label</h5>
                                <p class="text-warning">Some representative placeholder content for the third slide.</p>
                            </div>
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleDark"
                        data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleDark"
                        data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>


            </div>
            <div class="col-4 row">
                <img class="img-fluid"
                    src="https://images.unsplash.com/photo-1647892591690-25cf830cda51?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=580&q=80"
                    style="height: 350px;" alt="">

            </div>
        </section>
        <section>
            <div class="row d-flex align-content-center justify-content-evenly">
                <div class="col-12">
                    <div class="container my-3 mt-5" id="featureContainer">
                        <div class="row mx-auto my-auto justify-content-center">
                            <div id="featureCarousel" class="carousel slide" data-bs-ride="carousel">
                                <div class="d-flex justify-content-between position-relative top-50 z-1"
                                    style="z-index: 1;">
                                    <a class="indicator" href="#featureCarousel" role="button" data-bs-slide="prev">
                                        <span class="fas fa-chevron-left" aria-hidden="true"></span>
                                    </a> &nbsp;&nbsp;
                                    <a class="w-aut indicator" href="#featureCarousel" role="button"
                                        data-bs-slide="next">
                                        <span class="fas fa-chevron-right" aria-hidden="true"></span>
                                    </a>
                                </div>
                                <div class="carousel-inner" id="carousel-cat" role="listbox">


                                </div>

                            </div>
                        </div>
                    </div>




                </div>
            </div>
        </section>
        <section class="row justify-content-around d-flex" style="height: 440px; margin-top: 2%;">
            <div class="card" style="width: 15rem;">
                <img src="https://cdn-icons-png.flaticon.com/512/528/528098.png?w=740&t=st=1678265263~exp=1678265863~hmac=4dde90939c03b738fb47b26fd611a82bbe2bc10b8dcf6ab5f628ed445f9e0946"
                    class="card-img-top" alt="...">
                <div class="card-body">
                    <h5 class="card-title justify-content-center d-flex text-warning">Card title</h5>
                    <p class="card-text justify-content-center d-flex text-warning">Some quick example text to build on
                        the card title and make up the bulk of the card's content.</p>
                    <a href="#" class="btn btn-primary text-warning  justify-content-center d-flex">Go somewhere</a>
                </div>
            </div>
            <div class="card" style="width: 15rem;">
                <img src="https://cdn-icons-png.flaticon.com/512/188/188995.png?w=740&t=st=1678265308~exp=1678265908~hmac=323be4e9cc6cafcbe7a15433db7319e1bebb39b6e940014fce467e75072f121c"
                    class="card-img-top" alt="...">
                <div class="card-body">
                    <h5 class="card-title justify-content-center d-flex text-warning">Card title</h5>
                    <p class="card-text justify-content-center d-flex text-warning">Some quick example text to build on
                        the card title and make up the bulk of the card's content.</p>
                    <a href="#" class="btn btn-primary text-warning justify-content-center d-flex">Go somewhere</a>
                </div>
            </div>
            <div class="card bg-light" style="width: 15rem;">
                <img src="https://cdn-icons-png.flaticon.com/512/189/189003.png?w=740&t=st=1678265327~exp=1678265927~hmac=dd6f2f7108486114c891270593900e506853b81941d00d6c35dd6bf76b187ee9"
                    class="card-img-top" alt="...">
                <div class="card-body">
                    <h5 class="card-title justify-content-center d-flex text-warning">Card title</h5>
                    <p class="card-text justify-content-center d-flex text-warning">Some quick example text to build on
                        the card title and make up the bulk of the card's content.</p>
                    <a href="#" class="btn btn-primary text-warning justify-content-center d-flex">Go somewhere</a>
                </div>
            </div>

        </section>

        <section class="row d-flex justify-content-between" style="height: 300px; margin-top: 2%; margin-bottom: 3%;">
            <div class="row col-6 justify-content-center align-content-center">
                <img class="img-fluid" style="height: 75%;"
                    src="https://images.unsplash.com/photo-1638613067237-b1127ef06c00?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1032&q=80"
                    alt="">
            </div>
            <div class="row col-6 justify-content-center align-content-center">
                <img class="img-fluid" style="height: 75%;"
                    src="https://images.unsplash.com/photo-1638613067237-b1127ef06c00?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1032&q=80"
                    alt="">

            </div>
        </section>

        <section class="row d-flex justify-content-around align-content-around " style="height: 300px">
            <div class="row">
                <div class="col-4 d-grid gap-2 mb-2 d-flex justify-content-evenly">
                    <img src="https://cdn-icons-png.flaticon.com/512/189/189000.png?w=740&t=st=1678344848~exp=1678345448~hmac=4f2be20a2a4bf0fc556c2cce7114fc2688fba74aeeffb010215659ba4d5dcf04"
                        style="height: 180px;" class="mb-3">
                </div>
                <div class="col-4 d-grid gap-2 mb-2 d-flex justify-content-evenly">
                    <img src="https://cdn-icons-png.flaticon.com/512/188/188987.png?w=740&t=st=1678345155~exp=1678345755~hmac=205be813fa5e2bb9a27ccb65c160c7467b4514041bcbf5a3ba5f263a238fb876"
                        style="height: 180px;">
                </div>
                <div class="col-4 d-grid gap-2 mb-2 d-flex justify-content-evenly" style="padding-right: 5%;">
                    <img src="https://cdn-icons-png.flaticon.com/512/189/189005.png?w=740&t=st=1678344942~exp=1678345542~hmac=18c053d2b20dada94d7199d8076be543d611ce11a1aa039d033fb3f9cf5b6cfe"
                        style="height: 180px;" class="mb-3">
                </div>



                <div class="row">
                    <div class="col-4 d-grid gap-2 mb-2 d-flex justify-content-evenly">
                        <a href="#" class="btn btn-primary text-warning">POKEMON</a>
                    </div>
                    <div class="col-4 d-grid gap-2 mb-2 d-flex justify-content-evenly">
                        <a href="#" class="btn btn-primary text-warning">POKEMON</a>
                    </div>
                    <div class="col-4 d-grid gap-2 mb-2 d-flex justify-content-evenly">
                        <a href="#" class="btn btn-primary text-warning">POKEMON</a>
                    </div>


                </div>
        </section>

        <footer class="row bg-danger" style="height: 300px;">
            <div class="row col-12">

            </div>

        </footer>


    </div>
    </div>
</body>

</html>
<script>
    const categorias = []

    function getTypePokemon() {
        return new Promise((resolve) => {
            fetch("https://pokeapi.co/api/v2/type")
                .then(response => response.json())
                .then(data => {

                    data.results.forEach(element => {
                        categorias.push(element)
                    });
                    resolve("Categorias OK")
                    // console.log(data.results)

                })
        })


    }



    function slideCatPokemon() {
        getTypePokemon().then(response => {
            let categoria;

            categorias.forEach((element, index) => {


                if (index == 0) {
                    categoria += `<div class="carousel-item active">
                                        <div class="col-md-2">
                                            <div class="card">
                                                <div class="card-img rounded-circle">
                                                    <a onclick="localUrlPokemon('${element.url}')" href="typesPokemon.html">
                                                    <img src="https://cdn.pixabay.com/photo/2016/07/23/13/21/pokemon-1536855_1280.png"
                                                        class="img-fluid" >
                                                    </a>
                                                </div>
                                                <div class="card-img-overlays">${element.name}</div>
                                            </div>
                                        </div>
                                    </div>`

                } else {
                    categoria += `<div class="carousel-item">
                                        <div class="col-md-2">
                                            <div class="card">
                                                <div class="card-img">
                                                    <a onclick="localUrlPokemon('${element.url}')" href="typesPokemon.html">
                                                    <img src="https://cdn.pixabay.com/photo/2016/07/23/13/21/pokemon-1536855_1280.png"
                                                        class="img-fluid">
                                                        </a>
                                                </div>
                                                <div class="card-img-overlays">${element.name}</div>
                                            </div>
                                        </div>
                                    </div>`

                }

            });

            document.getElementById("carousel-cat").innerHTML = categoria
            flipCarrousel()
        });

    };
    function localUrlPokemon(urlType) {
        localStorage.setItem("url", urlType)
    };

    slideCatPokemon()


    function mostrarCategorias() {
        getTypePokemon().then(response => {
            let categoriass = `<div class="btn-group" role="group">
                        <button id="btnGroupDrop1" type="button" class="btn btn-primary btn-lg dropdown-toggle"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Categorias

                        </button>
                        <ul class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                `
            categorias.forEach((element) => {

                categoriass += `
                            <li><a class="dropdown-item text-warning" onclick="localUrlPokemon('${element.url}')"  href="typesPokemon.html"
                                    style="-webkit-text-stroke: 1px rgb(23, 78, 228);">${element.name}</a></li>
                            
                        `

            })
            categoriass += `</ul></div>`
            document.getElementById("mostrarCategoriasPokemon").innerHTML = categoriass
            // document.getElementById("mostrarCategoriasPokemon").style = "overflow:scroll;height:300px;width:22%;position:absolute;z-index: 1;"
        })

    }

    mostrarCategorias();


</script>

<script>

    var carritoCompras = []
    var arregloPokemon = []

    function flipCarrousel() {
        let myCarousel = document.querySelectorAll('#featureContainer .carousel .carousel-item');
        myCarousel.forEach((el) => {
            const minPerSlide = 4
            let next = el.nextElementSibling
            for (var i = 1; i < minPerSlide; i++) {
                if (!next) {
                    // wrap carousel by using first child
                    next = myCarousel[0]
                }
                let cloneChild = next.cloneNode(true)
                el.appendChild(cloneChild.children[0])
                next = next.nextElementSibling
            }
        })
    }

    function loadAllPokemon() {
        fetch("https://pokeapi.co/api/v2/pokemon?limit=100000&offset=0")
            .then((response) => response.json())
            .then(data => {
                // console.log(data.results);
                arregloPokemon = Object.values(data.results)
            })
    }

    function autoCompletePokemon() {
        let textoBuscar = document.getElementById("txtBuscar").value
        if (textoBuscar.length >= 3) {
            const filtroPokemon = arregloPokemon.filter(filtrarPokemon)
            // console.log(filtroPokemon)

            let lista = `<div class="list-group" >`
            filtroPokemon.forEach(element => {
                iconoPokemon(element.url)
                lista +=
                    `<a onclick="detallePokemon('${element.url}')" href="Pokemones.html" class="list-group-item list-group-item-action">${element.name} <img id="icono${element.name}"></a>`

            });
            lista += "</div>"
            document.getElementById("listPokemon").style = "overflow:scroll;height:300px;width:22%;position:absolute;z-index: 1;"
            document.getElementById("listPokemon").innerHTML = lista

        } else {
            document.getElementById("listPokemon").innerHTML = ""
            document.getElementById("listPokemon").style = "overflow:hidden;"
        }


    }

    function iconoPokemon(urlPokemoncito) {
        fetch(urlPokemoncito)
            .then(response => response.json())
            .then(data => {
                let icono = data.sprites.front_default
                document.getElementById(`icono${data.name}`).src = icono
            })
    }

    function filtrarPokemon(element) {
        let textoBuscar = document.getElementById("txtBuscar").value
        let nombre = element.name
        return nombre.includes(textoBuscar.toLowerCase())
    }

    function detallePokemon(urlLink) {
        localStorage.urlPokemoncito = urlLink;
    }


    function detallePokemones(urlPokemoncito) {
        fetch(urlPokemoncito)
            .then(response = response.json())
            .then(data => {

            })
    }


    function allowDrop(ev) {
        ev.preventDefault();
    }

    function drag(ev) {
        let name
        switch (ev.target.nodeName) {
            case "DIV":
                name = ev.target.id.slice(4)
                break;
            case "IMG":
                name = ev.target.id.slice(3)
                break;
            default:
                break;
        }
        ev.dataTransfer.setData("name", name);
    }
    function drop(ev) {

        ev.preventDefault();
        backInfoPokemon(ev.dataTransfer.getData("name"))


    }
    function backInfoPokemon(name) {
        fetch("https://pokeapi.co/api/v2/pokemon/" + name)
            .then(response => response.json())
            .then(data => {
                // console.log(data);
                let cantidad = document.getElementById("cantpikachu").value
                if (cantidad >= 1) {
                    let pokemon = new Pokemon(data.name, cantidad, data.base_experience * 100, data.sprites.other["official-artwork"].front_default)
                    carritoCompras.push(pokemon)
                    localStorage.datosPokemon = JSON.stringify(carritoCompras)
                    carritoPokemon()

                    const offcanvas = document.getElementById('offcanvasRight');
                    const offcanvasInstance = new bootstrap.Offcanvas(offcanvas);
                    offcanvasInstance.show();

                } else {
                    alert("Error cantidad incorrecta")
                }

            })
    }
    function carritoPokemon() {
        let items = ''
        carritoCompras.forEach(element => {
            items += `
            <div class="row my-3">
                    <img src="${element._imagen}" style="width: 35%;" alt="">
            </div>
                    <div class="col-8">
                        <div class="row">Nombre: ${element._nombre}</div>
                        <div class="row">Precio: ${element._precio} x ${element._cantidad} = ${element._precio * element._cantidad}</div>
                         <div class="row">Cantidad: ${element._cantidad}</div>
            </div>`
        })
        document.getElementById("listcarpokemon").innerHTML = items
        document.getElementById("cantidadItems").innerHTML = `${carritoCompras.length}+`
    }

    function traerCompra() {
        let datos = JSON.parse(localStorage.datosPokemon)
        datos.forEach(element => {
            carritoCompras.push(element)

        })
        carritoPokemon();
    }

    function backInfoPokemon(name) {
        fetch("https://pokeapi.co/api/v2/pokemon/" + name)
            .then(response => response.json())
            .then(data => {
                // console.log(data);
                let cantidad = document.getElementById(`cant${name}`).value
                if (cantidad >= 1) {
                    let pokemon = new Pokemon(data.name, cantidad, data.base_experience * 100, data.sprites.other["official-artwork"].front_default)
                    carritoCompras.push(pokemon)
                    localStorage.datosPokemon = JSON.stringify(carritoCompras)
                    carritoPokemon()

                    const offcanvas = document.getElementById('offcanvasRight');
                    const offcanvasInstance = new bootstrap.Offcanvas(offcanvas);
                    offcanvasInstance.show();

                } else {
                    alert("Error cantidad incorrecta")
                }

            })
    }
    function carritoPokemon() {
        let items = ''
        carritoCompras.forEach((element, index) => {
            items += `
            <div class="row my-3">
                    <img src="${element._imagen}" style="width: 35%;" alt="">
            </div>
                <div class="col-6">
                        <div class="row">Nombre: ${element._nombre}</div>
                        <div class="row">Precio: ${element._precio} x ${element._cantidad} = ${element._precio * element._cantidad}</div>
                        <div class="row">Cantidad: <input onclick="actCantidad(this,${index})" onkeyup="actCantidad(this,${index})" class="form-control" type="number" value="${element._cantidad}"></div>
                        <div class="col-2">
                            <a onclick="eliminarPokemon('${index}')" class="btn btn-sm btn-danger">X</a>
                        </div>
                </div>`
        })
        document.getElementById("listcarpokemon").innerHTML = items
        document.getElementById("cantidadItems").innerHTML = `${carritoCompras.length}+`
        totalCompra()
    }

    function traerCompra() {
        let datos = JSON.parse(localStorage.datosPokemon)
        datos.forEach(element => {
            carritoCompras.push(element)

        })
        carritoPokemon();
    }

    function eliminarPokemon(index) {
        carritoCompras.splice(index, 1)
        localStorage.datosPokemon = JSON.stringify(carritoCompras)
        carritoPokemon()
    }
    function totalCompra() {
        let totalPagar = 0
        carritoCompras.forEach(element => {
            totalPagar += (element._precio * element._cantidad)
        });
        document.getElementById("totalPagar").innerHTML = `<b>Total: $ </b> ${totalPagar}`
    }

    function actCantidad(element, index) {

        // console.log(element.value);
        // console.log(index);
        carritoCompras[index]._cantidad = element.value
        localStorage.datosPokemon = JSON.stringify(carritoCompras)
        carritoPokemon()

    }

</script>